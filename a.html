<body>
    <div class="details">
        <table id="order-table">
            <thead>
                <tr>
                    <th>Order</th>
                    <th>Product Code</th>
                    <th>Specs</th>
                    <th>Pack Size M2</th>
                    <th>Pack Qty</th>
                    <th>Total M2</th>
                    <th>Remark</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td><input type="text" name="product_code_1"></td>
                    <td><input type="text" name="specs_1"></td>
                    <td><input type="number" name="pack_size_1" class="pack-size"></td>
                    <td><input type="number" name="pack_qty_1" class="pack-qty"></td>
                    <td><input type="text" name="total_m2_1" class="total-m2" readonly></td>
                    <td><input type="text" name="remark_1"></td>
                    <td><button type="button" class="delete-row">Delete</button></td>
                </tr>
                <tr>
                    <td>Grand Total:</td>
                    <td colspan="7"><input type="text" name="grand_total" id="grand-total" readonly></td>
                </tr>
            </tbody>
        </table>
        <button type="button" id="add-item">Add Item</button>
    </div>

    <script>
        document.getElementById('add-item').addEventListener('click', function () {
            const table = document.getElementById('order-table').querySelector('tbody');
            const rowCount = table.rows.length - 1; // excluding grand total row
            const newRow = table.insertRow(rowCount);

            newRow.innerHTML = `
            <td>${rowCount}</td>
            <td><input type="text" name="product_code_${rowCount}"></td>
            <td><input type="text" name="specs_${rowCount}"></td>
            <td><input type="number" name="pack_size_${rowCount}" class="pack-size"></td>
            <td><input type="number" name="pack_qty_${rowCount}" class="pack-qty"></td>
            <td><input type="text" name="total_m2_${rowCount}" class="total-m2" readonly></td>
            <td><input type="text" name="remark_${rowCount}"></td>
            <td><button type="button" class="delete-row">Delete</button></td>
            `;

            attachEvents(newRow);
        });

        function attachEvents(row) {
            row.querySelector('.delete-row').addEventListener('click', function () {
                row.remove();
                updateGrandTotal();
            });

            row.querySelector('.pack-size').addEventListener('input', updateRowTotal);
            row.querySelector('.pack-qty').addEventListener('input', updateRowTotal);
        }

        function updateRowTotal() {
            const row = this.closest('tr');
            const packSize = parseFloat(row.querySelector('.pack-size').value) || 0;
            const packQty = parseFloat(row.querySelector('.pack-qty').value) || 0;
            const totalM2 = packSize * packQty;
            row.querySelector('.total-m2').value = totalM2.toFixed(3);
            updateGrandTotal();
        }

        function updateGrandTotal() {
            const totalM2Fields = document.querySelectorAll('.total-m2');
            let grandTotal = 0;
            totalM2Fields.forEach(field => {
                grandTotal += parseFloat(field.value) || 0;
            });
            document.getElementById('grand-total').value = grandTotal.toFixed(3);
        }

        // Attach events to existing rows
        document.querySelectorAll('#order-table tbody tr').forEach(row => {
            attachEvents(row);
        });
    </script>
</body>
